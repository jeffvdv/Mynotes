# Networking

## VPC Overview

VPC peering allows you to connect one VPC with another via a direct network route using
private IP addresses. Also connect to VPC on other AWS account.

Peering is in a star configuration: 1 central VPC peers with 4 others (no transitive peering).

## Build VPC

First 4 address and last 1 in a VPC subnet are reserved ip address.

Only 1 internet gateway can be assigned to 1 VPC.

After creating a route table for accessing the internet through the internet gateway for 
you public subnet. Select the subnet associated with that table and modify auto-assign IP
=> enable auto-assign public IPv4 address.

Nat Gateways operate via IPv4 and Egress Only Internet Gateways operate via IPv6.

1 Subnet can only be associated to 1 network ACL.

Be default all network rules are denied. You have to add rules inbound and outbound.
Use ephemeral ports (1024-65...). Rules are in numerical order (lowest has most priority)

## VPC endpoints

Make requests over the private network to f.e S3

2 Types:
- Interface
- Gateway (S3 and DynamoDB)

## VPC Flow Logs

Flow logs can be created at 3 levels:

- VPC 
- Subnet
- Network Interface Level

Create by selecting VPC => Actions => Create Flow Log (All, Accepted or Rejected)
=> Create a role to store to Cloudwatch => Create log group

You can streams logs to Lambda or ElasticSearch

Once created, you cannot modify IAM role.

Not monitored:
- Traffic generated by instances to contact Amazon DNS (unless your own DNS)
- Windows License activation
- Traffic to instance metadata 169.254.169.254
- DHCP traffic
- Traffic to reserved IP address for the default VPC router

## Direct Connect

Customer network connects trough the AWS backbone network via AWS Direct Connect on a 
Private Virtual interface.

With multiple regions you can use Direct Connect Gateway (Like a NAT gateway).
Virtual private interface is connect to Direct Connect Gateway.

# DNS

ALIAS record can point to apex records (CNAME can't)

Types of Routing policies:
- Simple Routing Policy
    - 1 record can hold multiple ip addresses (Shown in random order)
- Weighted Routing Policy
    - f.e. 20% to one region, 80% to other region
    - Multiple records (apex records) with weights
- Latency Routing Policy
    - Routing based on lowest network latency (can depend on location of user)
- Failover Routing Policy
    - Create Health checks in route53 first
    - You can create an alarm as well
    - Select primary and secondary
    - Assign your primary record with a healthcheck
- Geolocation Routing Policy
    - Based on users location routing to maybe a specific website for that continent
    - Create a default one as well
- Multivalue Routing Policy
    - Create more records with each their own ip address (with health checks)
    





